<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html lang="zh-tw">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.css">
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="/css/style.css">
		<script src="/CoreScripts/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/bootstrap-table.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/extensions/multiple-search/bootstrap-table-multiple-search.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/locale/bootstrap-table-zh-TW.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/locale/bootstrap-table-zh-TW.min.js"></script>
	</head>
	<body>
        <div class="load_modal"></div>
		<datalist id="part_list" class="normal_font"></datalist>
        <datalist id="serial_list" class="normal_font"></datalist>
		<div id="mo_cnt" class="page_container">
            <label for="part_num_in">製造品號 :</label><input id="part_num_in" class="part_attr input_container part_list_style normal_font" name="part_num_list" list="part_list" />
            <br><label for="part_items_in">製造數量 :</label><input id="part_items_in" class="part_attr input_container normal_font" name="part_items" type="number" style="width:100px" value="1" min="1" />
            <br><label for="part_remark_in">備註 : </label>
            <br><textarea id="part_remark_in" class="part_attr normal_font" name="part_remark" rows="5" cols="50" wrap="hard" ></textarea>
            <br><button type="button" class="btn btn-primary btn_field" onclick="generate_btn()">產生製令</button>
		</div>
		<script language="JavaScript">
			var body = $("body");
			var element_refnum = "mo_cnt";
            var serial_list_options;
            
			$(document).on({
				ajaxStart: function(){
					body.addClass("loading");
				},
				ajaxStop: function(){ 
					body.removeClass("loading");
				}
			});

			$(document).ready(function(){
				body.addClass("loading");
				var part_list_options = sessionStorage.getItem( "part_options" );
				$("#part_list").empty();
				$("#part_list").append( part_list_options );
				setTimeout(function() { 
					body.removeClass("loading"); 
				}, 1000);
			});
            
            // click generate button
            function generate_btn(){
                var cnt = document.getElementById( element_refnum );
                remove_bomtable_interface( cnt );
                remove_serialtable_interface( cnt );
                res_gen_mo_btn( cnt );
            }
            
			// Remove Bom table interface
			function remove_bomtable_interface( cnt ){
				var div_obj = document.getElementById( "bom" );
                if( div_obj !== null ){
                    cnt.removeChild( div_obj );
                    console.log( "rem_bom" );
                }
                
			}
            
			// Remove Serial table interface
			function remove_serialtable_interface( cnt ){
				var div_obj = document.getElementById( "serial" );
                if( div_obj !== null ){
                    cnt.removeChild( div_obj );
                    console.log( "rem_serial" );
                }
			}
            
            function open_serial_btn( part_num, serial_str ){
                var cnt = document.getElementById( element_refnum );
                remove_serialtable_interface( cnt );
                /*receive_to_db( "", attr ).then( function (result){
                    $("#serial_list").empty();
                    $("#serial_list").append( serial_list_options );
                });*/
                
                div_first_obj = document.createElement( "div" );
                div_first_obj.id = "serial";
                div_first_obj.setAttribute("class", "tab_form");
                cnt.appendChild(div_first_obj);
                
                var div_second_obj = document.createElement( "div" );
                div_second_obj.setAttribute("class", "text_field");
                div_first_obj.appendChild( div_second_obj );
                
                var table_title = new Array();
                var title_len = table_title.length;
                table_obj = document.createElement( "table" );
                thead_obj = document.createElement( "thead" );
                tbody_obj = document.createElement( "tbody" );
                tr_obj = document.createElement( "tr" );
                table_obj.border = "1";
                table_title = [ '序號' ];
                var style_str = "style='width:100px;text-align:center' ";
                var title_str = "<td " + style_str + ">" + table_title[0] + "</td>";
                tr_obj.innerHTML = title_str;
                thead_obj.appendChild( tr_obj );
                table_obj.appendChild( thead_obj );
                
                var serial_arr = serial_str.split(",");
                var data_len = serial_arr.length;
                var data_str = "";
                var res_str = "";
                for( var i=0; i<data_len; i++ ){
                    tr_obj = document.createElement( "tr" );
                    res_str = serial_arr[i];
                    data_str = "<td style='height:35px;text-align:center' >";
                    data_str += '<input class="input_container serial_list_style normal_font" value="'+ res_str +'" list="serial_list" onchange="upd_serial_num( this.value )"/>';
                    data_str += "</td>";

                    tr_obj.innerHTML = data_str;
                    tbody_obj.appendChild( tr_obj );
                }
                
                table_obj.appendChild( tbody_obj );
                div_first_obj.appendChild( table_obj );
            }
            
            function upd_serial_num( value ){
                console.log( value );
            }
            
		</script>
		<script type="text/javascript" src="/SubScripts/db_send.js"></script>
		<script type="text/javascript" src="/SubScripts/macro_send.js"></script>
		<script type="text/javascript" src="/SubScripts/db_receive.js"></script>
		<script type="text/javascript" src="/SubScripts/macro_receive.js"></script>
		<script type="text/javascript" src="/SubScripts/part_number.js"></script>
		<script type="text/javascript" src="/SubScripts/get.js"></script>
		<script type="text/javascript" src="/SubScripts/ctrl_table.js"></script>
		<script type="text/javascript" src="/SubScripts/response_button.js"></script>
	</body>
</html>
